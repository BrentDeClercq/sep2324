{"version":3,"file":"forms-settings.mjs","sources":["../src/FormsSettings.vue","../src/settings.js"],"sourcesContent":["<!--\n  - @copyright Copyright (c) 2021 Jonas Rittershofer <jotoeri@users.noreply.github.com>\n  -\n  - @author Jonas Rittershofer <jotoeri@users.noreply.github.com>\n  -\n  - @license AGPL-3.0-or-later\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  -\n  -->\n\n<template>\n\t<div>\n\t\t<NcSettingsSection :name=\"t('forms', 'Form creation')\">\n\t\t\t<NcCheckboxRadioSwitch ref=\"switchRestrictCreation\"\n\t\t\t\t:checked.sync=\"appConfig.restrictCreation\"\n\t\t\t\tclass=\"forms-settings__creation__switch\"\n\t\t\t\ttype=\"switch\"\n\t\t\t\t@update:checked=\"onRestrictCreationChange\">\n\t\t\t\t{{ t('forms', 'Restrict form creation to selected groups') }}\n\t\t\t</NcCheckboxRadioSwitch>\n\t\t\t<NcSelect v-model=\"appConfig.creationAllowedGroups\"\n\t\t\t\t:disabled=\"!appConfig.restrictCreation\"\n\t\t\t\t:multiple=\"true\"\n\t\t\t\t:options=\"availableGroups\"\n\t\t\t\t:placeholder=\"t('forms', 'Select groups')\"\n\t\t\t\tclass=\"forms-settings__creation__multiselect\"\n\t\t\t\tlabel=\"displayName\"\n\t\t\t\t@input=\"onCreationAllowedGroupsChange\" />\n\t\t</NcSettingsSection>\n\t\t<NcSettingsSection :name=\"t('forms', 'Form sharing')\">\n\t\t\t<NcCheckboxRadioSwitch ref=\"switchAllowPublicLink\"\n\t\t\t\t:checked.sync=\"appConfig.allowPublicLink\"\n\t\t\t\ttype=\"switch\"\n\t\t\t\t@update:checked=\"onAllowPublicLinkChange\">\n\t\t\t\t{{ t('forms', 'Allow sharing by link') }}\n\t\t\t</NcCheckboxRadioSwitch>\n\t\t\t<NcCheckboxRadioSwitch ref=\"switchAllowPermitAll\"\n\t\t\t\t:checked.sync=\"appConfig.allowPermitAll\"\n\t\t\t\ttype=\"switch\"\n\t\t\t\t@update:checked=\"onAllowPermitAllChange\">\n\t\t\t\t{{ t('forms', 'Allow sharing to all logged in accounts') }}\n\t\t\t</NcCheckboxRadioSwitch>\n\t\t</NcSettingsSection>\n\t</div>\n</template>\n\n<script>\nimport { showError } from '@nextcloud/dialogs'\nimport { loadState } from '@nextcloud/initial-state'\nimport { generateUrl } from '@nextcloud/router'\nimport axios from '@nextcloud/axios'\nimport NcCheckboxRadioSwitch from '@nextcloud/vue/dist/Components/NcCheckboxRadioSwitch.js'\nimport NcSelect from '@nextcloud/vue/dist/Components/NcSelect.js'\nimport NcSettingsSection from '@nextcloud/vue/dist/Components/NcSettingsSection.js'\n\nimport logger from './utils/Logger.js'\n\nexport default {\n\tname: 'FormsSettings',\n\n\tcomponents: {\n\t\tNcCheckboxRadioSwitch,\n\t\tNcSelect,\n\t\tNcSettingsSection,\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tappConfig: loadState(appName, 'appConfig'),\n\t\t\tavailableGroups: loadState(appName, 'availableGroups'),\n\t\t}\n\t},\n\n\tmethods: {\n\t\t/**\n\t\t * Similar procedures on**Change:\n\t\t *\n\t\t * - Show corresponding switch as loading\n\t\t * - Update value via api\n\t\t * - Only after everything is done (incl. possible reload on failure), unset loading.\n\t\t *\n\t\t * @param {boolean|Array} newVal The resp. new Value to store.\n\t\t */\n\t\tasync onRestrictCreationChange(newVal) {\n\t\t\tconst el = this.$refs.switchRestrictCreation\n\t\t\tel.loading = true\n\t\t\tawait this.saveAppConfig('restrictCreation', newVal)\n\t\t\tel.loading = false\n\t\t},\n\t\tasync onCreationAllowedGroupsChange(newVal) {\n\t\t\tconst el = this.$refs.switchRestrictCreation\n\t\t\tel.loading = true\n\t\t\tawait this.saveAppConfig('creationAllowedGroups', newVal.map(group => group.groupId))\n\t\t\tel.loading = false\n\t\t},\n\t\tasync onAllowPublicLinkChange(newVal) {\n\t\t\tconst el = this.$refs.switchAllowPublicLink\n\t\t\tel.loading = true\n\t\t\tawait this.saveAppConfig('allowPublicLink', newVal)\n\t\t\tel.loading = false\n\t\t},\n\t\tasync onAllowPermitAllChange(newVal) {\n\t\t\tconst el = this.$refs.switchAllowPermitAll\n\t\t\tel.loading = true\n\t\t\tawait this.saveAppConfig('allowPermitAll', newVal)\n\t\t\tel.loading = false\n\t\t},\n\n\t\t/**\n\t\t * Save a key-value pair to the appConfig.\n\t\t *\n\t\t * @param {string} configKey The key to store. Must be one of the used configKeys (See php-constants).\n\t\t * @param {boolean|Array} configValue The value to store.\n\t\t */\n\t\tasync saveAppConfig(configKey, configValue) {\n\t\t\ttry {\n\t\t\t\tawait axios.patch(generateUrl('apps/forms/config/update'), {\n\t\t\t\t\tconfigKey,\n\t\t\t\t\tconfigValue,\n\t\t\t\t})\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error('Error while saving configuration', { error })\n\t\t\t\tshowError(t('forms', 'Error while saving configuration'))\n\t\t\t\tawait this.reloadAppConfig()\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Reload the current AppConfig. Used to restore in case of saving-failure.\n\t\t */\n\t\tasync reloadAppConfig() {\n\t\t\ttry {\n\t\t\t\tconst resp = await axios.get(generateUrl('apps/forms/config'))\n\t\t\t\tthis.appConfig = resp.data\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error('Error while reloading config', { error })\n\t\t\t\tshowError(t('forms', 'Error while reloading config'))\n\t\t\t}\n\t\t},\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.forms-settings {\n\t&__creation__switch {\n\t\tmargin-block-end: 4px;\n\t}\n\n\t&__creation__multiselect {\n\t\twidth: 100%;\n\t}\n}\n</style>\n","/**\n * @copyright Copyright (c) 2022 Jonas Rittershofer <jotoeri@users.noreply.github.com>\n *\n * @author Jonas Rittershofer <jotoeri@users.noreply.github.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport { translate, translatePlural } from '@nextcloud/l10n'\nimport Vue from 'vue'\n\nimport FormsSettings from './FormsSettings.vue'\n\n// eslint-disable-next-line import/no-unresolved, n/no-missing-import\nimport 'vite/modulepreload-polyfill'\n\nVue.prototype.t = translate\nVue.prototype.n = translatePlural\n\nexport default new Vue({\n\t el: '#forms-settings',\n\t // eslint-disable-next-line vue/match-component-file-name\n\t name: 'FormsSettings',\n\t render: h => h(FormsSettings),\n})\n"],"names":["_sfc_main","NcCheckboxRadioSwitch","NcSelect","NcSettingsSection","loadState","appName","newVal","el","group","configKey","configValue","axios","generateUrl","error","logger","showError","resp","Vue","translate","translatePlural","h","FormsSettings"],"mappings":";iPAqEA,MAAAA,EAAA,CACA,KAAA,gBAEA,WAAA,CACA,sBAAAC,EACA,SAAAC,EACA,kBAAAC,CACA,EAEA,MAAA,CACA,MAAA,CACA,UAAAC,EAAAC,EAAA,WAAA,EACA,gBAAAD,EAAAC,EAAA,iBAAA,CACA,CACA,EAEA,QAAA,CAUA,MAAA,yBAAAC,EAAA,CACA,MAAAC,EAAA,KAAA,MAAA,uBACAA,EAAA,QAAA,GACA,MAAA,KAAA,cAAA,mBAAAD,CAAA,EACAC,EAAA,QAAA,EACA,EACA,MAAA,8BAAAD,EAAA,CACA,MAAAC,EAAA,KAAA,MAAA,uBACAA,EAAA,QAAA,GACA,MAAA,KAAA,cAAA,wBAAAD,EAAA,IAAAE,GAAAA,EAAA,OAAA,CAAA,EACAD,EAAA,QAAA,EACA,EACA,MAAA,wBAAAD,EAAA,CACA,MAAAC,EAAA,KAAA,MAAA,sBACAA,EAAA,QAAA,GACA,MAAA,KAAA,cAAA,kBAAAD,CAAA,EACAC,EAAA,QAAA,EACA,EACA,MAAA,uBAAAD,EAAA,CACA,MAAAC,EAAA,KAAA,MAAA,qBACAA,EAAA,QAAA,GACA,MAAA,KAAA,cAAA,iBAAAD,CAAA,EACAC,EAAA,QAAA,EACA,EAQA,MAAA,cAAAE,EAAAC,EAAA,CACA,GAAA,CACA,MAAAC,EAAA,MAAAC,EAAA,0BAAA,EAAA,CACA,UAAAH,EACA,YAAAC,CACA,CAAA,CACA,OAAAG,EAAA,CACAC,EAAA,MAAA,mCAAA,CAAA,MAAAD,CAAA,CAAA,EACAE,EAAA,EAAA,QAAA,kCAAA,CAAA,EACA,MAAA,KAAA,gBAAA,CACA,CACA,EAKA,MAAA,iBAAA,CACA,GAAA,CACA,MAAAC,EAAA,MAAAL,EAAA,IAAAC,EAAA,mBAAA,CAAA,EACA,KAAA,UAAAI,EAAA,IACA,OAAAH,EAAA,CACAC,EAAA,MAAA,+BAAA,CAAA,MAAAD,CAAA,CAAA,EACAE,EAAA,EAAA,QAAA,8BAAA,CAAA,CACA,CACA,CACA,CACA,ulDC1HAE,EAAI,UAAU,EAAIC,EAClBD,EAAI,UAAU,EAAIE,EAEH,IAAIF,EAAI,CACrB,GAAI,kBAEJ,KAAM,gBACN,OAAQG,GAAKA,EAAEC,CAAa,CAC9B,CAAC"}